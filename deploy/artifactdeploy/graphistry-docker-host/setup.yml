---
- hosts: all
  tasks:
    - name: Log in to Docker for our private images
      command: docker login -u {{ docker_username }} -p {{ docker_password }}

    - name: Directories for Graphistry config and logs
      file: state=directory owner={{ ansible_ssh_user }} path={{ item }}
      with_items: ["/etc/graphistry", "/var/graphistry", "/etc/graphistry/splunk", "/etc/graphistry/ssl"]
      become: yes
      become_user: root

    - name: Splunk host name
      template: src=inputs.conf.j2
                dest=/etc/graphistry/splunk/inputs.conf

    - name: Splunk server name
      template: src=server.conf.j2
                dest=/etc/graphistry/splunk/server.conf

    - name: Splunk deployment client
      template: src=deploymentclient.conf.j2
                dest=/etc/graphistry/splunk/deploymentclient.conf

    - name: Splunk outputs
      template: src=outputs.conf.j2
                dest=/etc/graphistry/splunk/outputs.conf

    - name: Place SSL certs
      copy: src=certs
            dest=/etc/graphistry/ssl

    - name: Place environment variables
      template: src=graphistry-docker-host.sh.j2
                dest=/etc/profile.d/graphistry-docker-host.sh
      become: yes
      become_user: root

    - name: Place launch script
      copy: src=launch.sh
            dest=/usr/bin/graphistry-launch.sh
            owner=root
            group=root
            mode=0755
      become: yes
      become_user: root

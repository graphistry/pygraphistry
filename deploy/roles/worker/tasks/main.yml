---
# Provisions instances that will run the viz-worker app. Includes installing the NVIDIA drivers and
# CUDA, and uploading and running reaper.py.

- { include: CUDA.yml, tags: [ 'cuda' ] }

- name: Install Python packages
  pip: name={{ item }}
  with_items:
    - pymongo
  sudo: yes

- name: Set Supervisor config for reaper.py
  template: src=reaper.conf.j2
            dest=/etc/supervisor/conf.d/reaper.conf
            owner=root
            group=graphistry-dev
            mode=0664
  sudo: yes
  sudo_user: root
  notify: Add reaper.py to Supervisor
  tags:
    - supervisor
    - reaper

- name: Upload reaper.py
  template: src=reaper.py.j2
            dest={{ graphistry_install_path }}/reaper.py
            owner=www
            group=graphistry-dev
            mode=0775
  sudo: yes
  sudo_user: root
  notify: Restart reaper.py
  tags:
    - supervisor
    - reaper

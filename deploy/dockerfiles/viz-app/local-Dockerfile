FROM graphistry/baseapp:1.2
ENV graphistry_install_path "/var/graphistry"
ENV graphistry_temp_path "/tmp/graphistry"
RUN mkdir -p /var/log/graphistry-json $graphistry_temp_path $graphistry_install_path \
             /var/log/central-app /var/log/clients /var/log/worker /var/log/graphistry-json /var/log/reaper /root/.ssh

WORKDIR $graphistry_install_path

RUN curl $(/sbin/ip route | awk '/default/ {print $3}'):17290/npm/rc > /root/.npmrc && \
    npm install @graphistry/viz-app@$VERSION && \
    rm /root/.npmrc

WORKDIR $graphistry_install_path/viz-app

CMD ls # bash -l -c 'npm run serve "{\"VIZ_LISTEN_ADDRESS\":\"0.0.0.0\", \"VIZ_LISTEN_PORT\": 80, \"GRAPHISTRY_LOG_LEVEL\": \"DEBUG\"}"'
